<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>我的书架 - 本地阅读</title>
  <!-- 禁用字体平滑以提高清晰度 -->
  <style>
    * {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
  </style>
  <link rel="stylesheet" href="src/css/qidian.css">
  <link rel="stylesheet" href="src/css/components.css">
</head>

<body>
  <header class="qd-header">
    <div class="qd-header-inner">
      <a href="#" class="qd-logo">
        <span>📚</span>
        <span>本地阅读</span>
      </a>

      <div class="qd-search-box">
        <input type="text" id="bookSearchInput" class="qd-search-input" placeholder="搜索书架..." />
        <button class="qd-search-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </button>
      </div>

      <div class="qd-actions">
        <button id="themeToggle" class="qd-btn qd-btn-outline">夜间模式</button>
        <button id="addBookBtn" class="qd-btn qd-btn-primary">添加书籍</button>
      </div>
    </div>
  </header>

  <div class="qd-container">
    <div class="qd-shelf-header">
      <div>
        <span class="qd-shelf-title">我的书架</span>
        <span id="bookshelfSummary" class="qd-shelf-stats"></span>
      </div>
      <div class="qd-controls">
        <select id="sortSelect" class="qd-select">
          <option value="recent">最近阅读</option>
          <option value="title">书名</option>
          <option value="added">添加时间</option>
        </select>
      </div>
    </div>

    <main id="bookshelfGrid" class="qd-book-grid">
      <!-- Books will be inserted here -->
    </main>

    <div id="bookshelfEmpty" class="qd-empty" hidden>
      <div class="qd-empty-icon">📂</div>
      <h3>书架空空如也</h3>
      <p>拖拽文件到此处，或点击右上角“添加书籍”</p>
    </div>
  </div>

  <footer class="qd-footer">
    <p>支持 EPUB / TXT / PDF · 本地存储 · 安全私密</p>
    <div style="margin-top: 10px;">
      <a href="reader.html">阅读器</a>
      <a href="user-data/" target="_blank">数据目录</a>
    </div>
  </footer>

  <input id="bookFileInput" type="file" accept=".epub,.txt,.pdf" multiple hidden />
  <div id="dragOverlay" class="drag-overlay"></div>
  <div id="toast" class="toast"></div>

  <!-- 添加书籍弹窗 -->
  <div id="addBooksMask" class="add-books-mask">
    <div class="add-books-modal">
      <div class="add-books-header">
        <h3 class="add-books-title">添加书籍</h3>
        <button id="addBooksClose" class="add-books-close" title="关闭">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <div class="add-books-body">
        <div id="dropZone" class="drop-zone">
          <div class="drop-zone-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
          </div>
          <p class="drop-zone-text">拖拽文件到此处</p>
          <p class="drop-zone-hint">或点击选择文件</p>
          <button id="selectFilesBtn" class="select-files-btn">选择文件</button>
          <p class="drop-zone-formats">支持 EPUB / TXT / PDF 格式</p>
        </div>
        
        <div class="files-section">
          <div class="files-header">
            <span class="files-title">待添加文件</span>
            <button id="clearFilesBtn" class="clear-files-btn">清空列表</button>
          </div>
          <div id="filesList" class="files-list">
            <div class="files-empty">
              <p>还没有选择任何文件</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="add-books-footer">
        <button id="cancelAddBtn" class="add-books-btn cancel">取消</button>
        <button id="confirmAddBtn" class="add-books-btn confirm" disabled>
          <span class="btn-text">添加书籍</span>
          <span class="btn-loading" style="display:none;">
            <svg class="spinner" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" stroke-dasharray="60" stroke-dashoffset="20"></circle>
            </svg>
            上传中...
          </span>
        </button>
      </div>
    </div>
  </div>
  <input id="fileInputModal" type="file" accept=".epub,.txt,.pdf" multiple hidden />

  <template id="bookCardTemplate">
    <article class="qd-book-card">
      <div class="qd-cover-wrapper">
        <img src="" alt="" class="qd-cover-img" loading="lazy" />
        <div class="qd-cover-placeholder" aria-hidden="true"></div>
        <button class="qd-delete-btn" title="删除">×</button>
      </div>
      <div class="qd-book-info">
        <div class="qd-book-title"></div>
        <div class="qd-book-meta">
          <span class="meta-info"></span>
          <span class="meta-tag"></span>
        </div>
      </div>
    </article>
  </template>

  <script type="module" src="src/js/bookshelfApp.js"></script>
</body>

</html>