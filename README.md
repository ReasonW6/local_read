# 🔖 本地电子书阅读器 (Local E-Book Reader)

[![Node.js](https://img.shields.io/badge/Node.js-v14%2B-green.svg)](https://nodejs.org/)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg)](https://github.com/ReasonW6/local_read/pulls)

> 一个运行在本地的电子书阅读网页应用，通过 Node.js 服务器稳定访问你的本地书库，支持手动记录阅读进度。支持EPUB、TXT、PDF格式，具备完整的配置管理和数据持久化功能。

[⚡快速开始](#-快速开始) | [📝使用说明](#-使用说明) | [🔧配置管理](#-配置管理)

## ✨ 主要功能

### 📖 **核心阅读功能**
- 📚 **多格式支持**: `.epub`、`.txt`、`.pdf` 格式电子书
- 📤 **便捷添加**: 支持拖拽上传和文件选择，快速添加书籍到本地书库
- 🎨 **沉浸式阅读**: 专为阅读优化的界面设计
- 🌓 **主题切换**: 亮色/暗色模式自由切换
- 🔧 **字体调节**: 字体大小、段落间距、字间距精细调整
- 📏 **排版定制**: 页宽、页边距、行距、段落间距、字间距全面可调
- 📑 **章节导航**: 清晰的目录结构，快速跳转章节
- 🔖 **书签系统**: 添加、管理、跳转书签
- ⚡ **键盘快捷键**: 全面的键盘操作支持

### 💾 **数据管理功能** 🆕
- 🔄 **一键保存**: 一键保存所有阅读数据和设置
- 🚀 **自动加载**: 启动时自动恢复所有配置
- 📦 **完整备份**: 包含阅读进度、书签、设置的完整配置文件
- 🔒 **数据安全**: 服务器端存储，不依赖浏览器缓存
- 🌐 **跨设备同步**: 通过配置文件实现设备间数据迁移

### 🎯 **特色功能**
- 📖 **最近阅读提示**: 自动标记上次阅读的书籍
- 🛡️ **隐私保护**: 完全本地运行，保护用户隐私
- 📊 **阅读进度**: 实时显示阅读进度条
- 🎨 **灵活定制**: 极宽范围的排版参数调整（页宽400-2000px，边距10-150px等）
- 🔄 **智能滚动**: 章节切换自动回到顶部，提供流畅阅读体验
- 🌐 **跨平台**: 支持 Windows、macOS、Linux

## 🐛 已知问题

- PDF目录导航精度有限
- 大型EPUB文件可能加载较慢
- ⚠️ **排版设置需要刷新**: 调整排版设置（页宽、页边距、行距等）后，需要刷新页面（按F5或Ctrl+R）才能看到完整效果

## 🚀 快速开始

### 📋 环境要求

- [Node.js](https://nodejs.org/) v14.0+ (推荐 LTS 版本)
- 现代浏览器 (Chrome, Firefox, Edge, Safari)

### ⚡ 安装步骤

1. **克隆项目**

   ```bash
   # 克隆仓库
   git clone https://github.com/ReasonW6/local_read.git
   
   # 进入项目目录
   cd local_read
   ```

   或者直接下载 ZIP 文件并解压。

2. **安装依赖**

    ```bash
    # 安装项目依赖
    npm install
    ```
    
    > **注意**: 项目现在使用了以下依赖包：
    > - `express`: Web 服务器框架
    > - `multer`: 文件上传处理中间件
    > 
    > 如果是首次设置或手动安装，也可以分别安装：
     ```bash
     npm install express multer
     ```
3. **添加电子书**

   将你的 `.epub`、`.txt` 或 `.pdf` 文件复制到 `books/` 文件夹中。

4. **启动服务器**

   ```bash
   # 启动服务器
   node server.js
   ```

   看到以下提示表示启动成功：
   ```
   E-book reader server listening at http://localhost:3000
   ```

   **💡 Windows 用户快捷方式：** 双击 `start.bat` 文件，会自动启动服务器并打开浏览器。

5. **开始阅读**

   在浏览器中访问 [http://localhost:3000](http://localhost:3000)，点击右侧工具栏的"书架"图标即可看到所有书籍。

## 📝 使用说明

### 📚 **书籍管理**
- **手动添加**: 将电子书文件放入 `books/` 文件夹
- **界面添加**: 点击"添加书籍"按钮，通过拖拽或文件选择上传

### 📖 **阅读控制**
- **工具栏**: 字体大小调整、主题切换、章节导航
- **设置面板**: 
  - 页宽调整（400-2000px）
  - 页边距设置（10-150px）
  - 行距调整（1.0-3.5）
  - 段落间距（0.2-4）
  - 字间距（0-5px）
  - > ⚠️ **重要提示**: 调整排版设置后，请刷新页面（F5或Ctrl+R）查看完整效果
- **键盘快捷键**: 
  - `←/→`: 上一章/下一章
  - `+/-`: 增大/减小字体
  - `T`: 切换主题
  - `B`: 添加书签
  - `S`: 保存进度

### 💾 **数据保存**
- **一键保存**: 点击"保存"按钮保存所有数据和设置
- **自动恢复**: 下次启动时自动加载所有配置

## 🔧 配置管理

### 🆕 **数据持久化功能**

本阅读器具备完整的配置管理系统，确保您的阅读数据永不丢失：

#### 📦 **自动保存的数据**
- ✅ **阅读进度**: 每本书的精确阅读位置
- ✅ **主题设置**: 日间/夜间模式偏好
- ✅ **字体配置**: 字体大小、段落间距、字间距
- ✅ **书签数据**: 所有书籍的书签记录
- ✅ **最近阅读**: 最后阅读的书籍标识
- ✅ **阅读偏好**: 个性化的排版设置

#### 🔄 **使用方法**

1. **保存数据**:
   ```
   点击工具栏的"保存"按钮 → 所有数据自动保存到 user-data/user-config.json
   ```

2. **自动恢复**:
   ```
   重新打开网站 → 自动加载配置文件 → 恢复所有设置和进度
   ```

3. **数据迁移**:
   ```
   复制 user-data/user-config.json 文件 → 在其他设备上覆盖同名文件 → 实现跨设备同步
   ```

#### 🛡️ **数据安全**
- **本地存储**: 配置文件保存在服务器端，不依赖浏览器缓存
- **自动备份**: 页面关闭时自动保存，防止数据丢失
- **格式标准**: 使用JSON格式，便于备份和迁移

## 📂 项目结构

```
local_read/
├── books/                                # 📚 存放电子书文件 (.epub, .txt, .pdf)
├── src/                                  # 💻 前端源码
│   ├── css/                              # 🎨 样式文件
│   │   ├── base.css                            # 基础样式和CSS变量（包含EPUB图片保护样式）
│   │   ├── bookshelf.css                       # 书架页面样式
│   │   ├── components.css                      # 组件样式
│   │   └── responsive.css                      # 响应式设计
│   └── js/                               # 📜 JavaScript模块
│       ├── app.js                        # 阅读器主应用逻辑
│       ├── bookshelfApp.js               # 书架页面应用逻辑
│       ├── core/                         # ⚙️ 核心模块
│       │   ├── config.js                       # 配置常量和DOM引用
│       │   └── state.js                        # 应用状态管理
│       └── modules/                      # 🧩 功能模块
│           ├── bookmarkManager.js              # 书签管理
│           ├── configManager.js                # 配置管理（扩展的排版参数范围）
│           ├── epubCore.js                     # EPUB核心功能（主题和图片样式处理）
│           ├── epubReader.js                   # EPUB阅读器
│           ├── fileManager.js                  # 文件管理
│           ├── pdfReader.js                    # PDF阅读器
│           ├── themeManager.js                 # 主题管理
│           ├── txtReader.js                    # TXT阅读器（章节导航优化）
│           └── uiController.js                 # UI控制器
├── user-data/                            # 💾 用户数据目录 
│   └── user-config.json                  # 用户配置文件 (自动生成)
├── node_modules/                         # 📦 项目依赖 (npm自动生成)
├── .gitignore                            # 🙈 Git忽略规则
├── index.html                            # 📚 书架首页
├── reader.html                           # 📖 阅读器页面
├── server.js                             # ⚙️ 后端服务器
├── package.json                          # 📄 项目配置文件
├── package-lock.json                     # 🔒 依赖版本锁定
├── start.bat                             # 🚀 一键启动脚本 (Windows)
└── README.md                             # 📖 项目说明文档
```

## 🛠️ 技术栈

- **后端**: Node.js, Express.js
- **前端**: HTML5, CSS3, Vanilla JavaScript (ES6 Modules)
- **核心库**: 
  - **ePub.js**: 用于解析和渲染 EPUB 文件
  - **PDF.js**: 用于解析和渲染 PDF 文件
  - **JSZip**: 用于处理压缩文件

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！


---

⭐ **如果这个项目对你有帮助，请给个 Star 支持一下！**